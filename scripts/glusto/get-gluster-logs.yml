- hosts: gluster_nodes[0]
  tasks:
  - name: Create a folder for each server
    file:
      state: directory
      path: "/root/gluster-logs/{{ item }}-{{ hostvars[item]['ansible_host'] }}"
    with_items: "{{ groups['gluster_nodes'][1:] }}"

  - name: Copy gluster logs
    synchronize:
      src: /var/log/glusterfs
      dest: "{{ /root/gluster-logs/{{ item }}-{{ hostvars[item]['ansible_host'] }}"
    delegate_to: "{{ item }}"
    with_items: "{{ groups['gluster_nodes'][1:] }}"

  - name: Copy samba logs
    synchronize:
      src: /var/log/samba
      dest: "{{ /root/gluster-logs/{{ item }}-{{ hostvars[item]['ansible_host'] }}"
    delegate_to: "{{ item}}"
    with_items: "{{ groups['gluster_nodes'][1:6] }}"

  - name: Archive the directory
    archive:
      path: "/root/gluster-logs"
      format: gz
      dest: "/root/gluster-logs.gz"
